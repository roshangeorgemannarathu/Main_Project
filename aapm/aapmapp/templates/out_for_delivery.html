{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900&display=swap" rel="stylesheet">
    <title>Aquarium and Petshop Management system HTML CSS Template</title>
    <!-- Additional CSS Files -->
    <link rel="stylesheet" type="text/css" href="{% static 'aapmapp/css/bootstrap.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'aapmapp/css/font-awesome.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'aapmapp/css/project.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'aapmapp/css/owl-carousel.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'aapmapp/css/lightbox.css' %}">
    <style>
        h1,
        h4 {
            color: black;
        }

        .dropdown-menu li {
            white-space: nowrap; /* Prevent line breaks */
        }

        .dropdown-menu {
            right: 0;
            left: auto;
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .user-photo {
            border-radius: 50%;
            width: 50px;
            height: 50px;
            margin-left: 10px;
        }
        
    </style>
</head>

<body>
    <!-- ***** Preloader Start ***** -->
    <div id="preloader">
        <div class="jumper">
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
    <!-- ***** Preloader End ***** -->

    <!-- ***** Header Area Start ***** -->
    <header class="header-area header-sticky">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <nav class="main-nav">
                        <!-- ***** Logo Start ***** -->
                        <h2>Pet Paradise Cart</h2>
                        <!-- ***** Logo End ***** -->
                        <!-- ***** Menu Start ***** -->
                        <ul class="nav">
                            <li><a href="{% url 'deliveryman_account' %}">Home</a></li>
                            <li><a href="{% url 'location' %}">Your Location</a></li>
                            <li><a href="{% url 'new_orders' %}">Orders</a></li>
                            
                            <li><a href="{% url 'profile' %}">Profile</a></li>
                            <li><a href="{% url 'change_password' %}">Change Password</a></li>
                            <li><a href="{% url 'logout' %}">Logout</a></li>
                            <li class="dropdown">
                                <!-- Add dropdown content here if needed -->
                            </li>
                        </ul>
                        <!-- ***** Menu End ***** -->
                    </nav>
                </div>
            </div>
        </div>
    </header>
    <br><br><br><br><br><br>
    <!-- ***** Header Area End ***** -->
    
    <div class="container">
        {% if messages %}
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {% if message.tags == 'success' %}
                <strong>Success:</strong>
            {% elif message.tags == 'info' %}
                <strong>Info:</strong>
            {% elif message.tags == 'warning' %}
                <strong>Warning:</strong>
            {% elif message.tags == 'danger' %}
                <strong>Error:</strong>
            {% endif %}
            {{ message }}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    {% endfor %}
{% endif %}

        <div class="row">
            <!-- Section for Pets (left side) -->
            <div class="col-md-6 mb-4">
                {% comment %} <h2>Pets</h2> {% endcomment %}
                {% for assignment in pending_assignments %}
                <div class="card">
                    <div class="card-body">
                        <!-- Display DeliveryAssignment (Pet) details -->
                        <h5 class="card-title">Order ID: {{ assignment.order_id }}</h5>
                        <p class="card-text">Product Name: {{ assignment.product }}</p>
                        <p class="card-text">Customer Name: {{ assignment.user }}</p>
                        <!-- Display address information -->
                        {% comment %} <p class="card-text">Address: {{ assignment.user_profile.housename }}, {{ assignment.user_profile.district }}, {{ assignment.user_profile.pincode }}</p> {% endcomment %}
                        <!-- Button trigger modal -->
                        {% comment %} <button type="button" class="btn btn-primary delivered-btn" data-toggle="modal" data-target="#otpModal{{ assignment.pk }}">
                            Delivered
                        </button> {% endcomment %}
                        <button type="button" class="btn btn-primary delivered-btn" data-toggle="modal" data-target="#otpModal{{ assignment.pk }}">
                            Delivered
                        </button>
                        
                        <!-- Modal -->
                        <!-- Modal -->
<div class="modal fade" id="otpModal{{ assignment.pk }}" tabindex="-1" role="dialog" aria-labelledby="otpModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="otpModalLabel">Enter OTP</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="otpForm{{ assignment.pk }}" method = "post" action ={% url "verify_otp" %}>
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="otpInput{{ assignment.pk }}">OTP:</label>
                        <input type= "hidden" name="delivery_assignment_id" value="{{ assignment.pk }}">
                        <input type="text" class="form-control" id="otpInput{{ assignment.pk }}" name="otp">
                    </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary">Submit</button>
            </form>
            
            </div>
        </div>
    </div>
</div>

                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Section for Pets (right side) -->
            <div class="col-md-6 mb-4">
                {% comment %} <h2>Pets</h2> {% endcomment %}
                {% for assignment in pending_assignments %}
                <div class="card">
                    <div class="card-body">
                        <!-- Display DeliveryAssignment (Pet) details -->
                        <h5 class="card-title">Order ID: {{ assignment.order_id }}</h5>
                        <p class="card-text">Product Name: {{ assignment.product }}</p>
                        <p class="card-text">Customer Name: {{ assignment.user }}</p>
                        <!-- Display address information -->
                        <p class="card-text">Address: {{ assignment.user_profile.housename }}, {{ assignment.user_profile.district }}, {{ assignment.user_profile.pincode }}</p>
                        <!-- Button trigger modal -->
                        <button type="button" class="btn btn-primary delivered-btn" data-toggle="modal" data-target="#otpModal{{ assignment.pk }}">
                            Delivered
                        </button>
                        <!-- Modal -->
                        <div class="modal fade" id="otpModal{{ assignment.pk }}" tabindex="-1" role="dialog" aria-labelledby="otpModalLabel" aria-hidden="true">
                            <!-- Modal content remains the same -->
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% comment %} <script>
        function submitOTP(assignmentId) {
            var otp = $('#otpInput' + assignmentId).val();
            $.ajax({
                type: 'POST',
                url: '/validate_otp/',
                data: {
                    'assignment_id': assignmentId,
                    'otp': otp,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function(data) {
                    alert('Delivery marked as complete!');
                    $('#otpModal' + assignmentId).modal('hide');
                    // You may want to refresh the page or update the UI here
                },
                error: function(xhr, status, error) {
                    alert('Error marking delivery as complete: ' + error);
                }
            });
        }
    </script> {% endcomment %}
    <!-- jQuery -->
    <script src="{% static 'aapmapp/js/jquery-2.1.0.min.js' %}"></script>

    <!-- Bootstrap -->
    <script src="{% static 'aapmapp/js/popper.js' %}"></script>
    <script src="{% static 'aapmapp/js/bootstrap.min.js' %}"></script>

    <!-- Plugins -->
    <script src="{% static 'aapmapp/js/owl-carousel.js' %}"></script>
    <script src="{% static 'aapmapp/js/accordions.js' %}"></script>
    <script src="{% static 'aapmapp/js/datepicker.js' %}"></script>
    <script src="{% static 'aapmapp/js/scrollreveal.min.js' %}"></script>
    <script src="{% static 'aapmapp/js/waypoints.min.js' %}"></script>
    <script src="{% static 'aapmapp/js/jquery.counterup.min.js' %}"></script>
    <script src="{% static 'aapmapp/js/imgfix.min.js' %}"></script>
    <script src="{% static 'aapmapp/js/slick.js' %}"></script>
    <script src="{% static 'aapmapp/js/lightbox.js' %}"></script>
    <script src="{% static 'aapmapp/js/isotope.js' %}"></script>

    <!-- Global Init -->
    <script src="{% static 'aapmapp/js/custom.js' %}"></script>

</body>

</html>
